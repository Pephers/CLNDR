/*! clndr.min.js v1.2.1 2014-09-02 */
!function(a){"function"==typeof define&&define.amd?define(["moment"],a):a("object"==typeof exports?require("moment"):moment)}(function(a,b){function c(a,b){b=b||document.body;var c=[];if(b.querySelectorAll)return b.querySelectorAll("."+a);for(var d=b.getElementsByTagName("*"),e=0,f=d.length;f>e;e++)-1!==d[e].className.indexOf(a)&&c.push(d[e]);return c}function d(a){function b(){}return b.prototype=a,new b}function e(){for(var a={},b=0,c=arguments.length;c>b;b++){var d=arguments[b];for(var e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}return a}function f(a,b,c){return a&&b&&c?a.addEventListener?(a.addEventListener(b,c,!1),!0):a.attachEvent?a.attachEvent("on"+b,c):!1:!1}var g="<div class='clndr-controls'><div class='clndr-control-button'><span class='clndr-previous-button'>previous</span></div><div class='month'><%= month %> <%= year %></div><div class='clndr-control-button rightalign'><span class='clndr-next-button'>next</span></div></div><table class='clndr-table' border='0' cellspacing='0' cellpadding='0'><thead><tr class='header-days'><% for (var i = 0; i < daysOfTheWeek.length; i++) { %><td class='header-day'><%= daysOfTheWeek[i] %></td><% } %></tr></thead><tbody><% for (var i = 0; i < numberOfRows; i++){ %><tr><% for (var j = 0; j < 7; j++){ %><% var d = j + i * 7; %><td class='<%= days[d].classes %>'><div class='day-contents'><%= days[d].day %></div></td><% } %></tr><% } %></tbody></table>",h="clndr",i={template:g,weekOffset:0,startWithMonth:null,clickEvents:{click:null,nextMonth:null,previousMonth:null,nextYear:null,previousYear:null,today:null,onMonthChange:null,onYearChange:null},targets:{nextButton:"clndr-next-button",previousButton:"clndr-previous-button",nextYearButton:"clndr-next-year-button",previousYearButton:"clndr-previous-year-button",todayButton:"clndr-today-button",day:"day",empty:"empty"},events:[],extras:null,dateParameter:"date",multiDayEvents:null,doneRendering:null,render:null,daysOfTheWeek:null,showAdjacentMonths:!0,adjacentDaysChangeMonth:!1,ready:null,constraints:null,forceSixRows:null},j=function(b,c){if(this.element=b,this.options=e({},i,c),this.options.events.length&&(this.options.events=this.options.multiDayEvents?this.addMultiDayMomentObjectsToEvents(this.options.events):this.addMomentObjectToEvents(this.options.events)),this.month=this.options.startWithMonth?a(this.options.startWithMonth).startOf("month"):a().startOf("month"),this.options.constraints){if(this.options.constraints.startDate){var d=a(this.options.constraints.startDate);this.month.isBefore(d,"month")&&(this.month.set("month",d.month()),this.month.set("year",d.year()))}if(this.options.constraints.endDate){var f=a(this.options.constraints.endDate);this.month.isAfter(f,"month")&&this.month.set("month",f.month()).set("year",f.year())}}this._defaults=i,this._name=h,this.init()};return j.prototype.init=function(){if(this.daysOfTheWeek=this.options.daysOfTheWeek||[],!this.options.daysOfTheWeek){this.daysOfTheWeek=[];for(var b=0;7>b;b++)this.daysOfTheWeek.push(a().weekday(b).format("dd").charAt(0))}if(this.options.weekOffset&&(this.daysOfTheWeek=this.shiftWeekdayLabels(this.options.weekOffset)),"function"!=typeof this.options.render){if(this.options.render=null,"undefined"==typeof _)throw new Error("Underscore was not found. Please include underscore.js OR provide a custom render function.");this.compiledClndrTemplate=_.template(this.options.template)}this.calendarContainer=document.createElement("div"),this.calendarContainer.className="clndr",this.element.appendChild(this.calendarContainer),this.render(),this.options.ready&&this.options.ready.apply(this,[])},j.prototype.shiftWeekdayLabels=function(a){for(var b=this.daysOfTheWeek,c=0;a>c;c++)b.push(b.shift());return b},j.prototype.createDaysObject=function(b){daysArray=[];var c=b.startOf("month");if(this.eventsLastMonth=[],this.eventsThisMonth=[],this.eventsNextMonth=[],this.options.events.length)if(this.options.multiDayEvents){this.eventsThisMonth=[];for(var e=0,f=this.options.events.length;f>e;e++)(this.options.events[e]._clndrStartDateObject.format("YYYY-MM")===b.format("YYYY-MM")||this.options.events[e]._clndrEndDateObject.format("YYYY-MM")===b.format("YYYY-MM"))&&this.eventsThisMonth.push(this.options.events[e]),this.options.events[e]._clndrStartDateObject.format("YYYY-MM")<=b.format("YYYY-MM")&&this.options.events[e]._clndrEndDateObject.format("YYYY-MM")>=b.format("YYYY-MM")&&this.eventsThisMonth.push(this.options.events[e]);if(this.options.showAdjacentMonths){var g=d(b).subtract("months",1),h=d(b).add("months",1);this.eventsLastMonth=[];for(var e=0,f=this.options.events.length;f>e;e++)(this.options.events[e]._clndrStartDateObject.format("YYYY-MM")===g.format("YYYY-MM")||this.options.events[e]._clndrEndDateObject.format("YYYY-MM")===g.format("YYYY-MM"))&&this.eventsThisMonth.push(this.options.events[e]),this.options.events[e]._clndrStartDateObject.format("YYYY-MM")<=g.format("YYYY-MM")&&this.options.events[e]._clndrEndDateObject.format("YYYY-MM")>=g.format("YYYY-MM")&&this.eventsThisMonth.push(this.options.events[e]);this.eventsNextMonth=[];for(var e=0,f=this.options.events.length;f>e;e++)(this.options.events[e]._clndrStartDateObject.format("YYYY-MM")===h.format("YYYY-MM")||this.options.events[e]._clndrEndDateObject.format("YYYY-MM")===h.format("YYYY-MM"))&&this.eventsThisMonth.push(this.options.events[e]),this.options.events[e]._clndrStartDateObject.format("YYYY-MM")<=h.format("YYYY-MM")&&this.options.events[e]._clndrEndDateObject.format("YYYY-MM")>=h.format("YYYY-MM")&&this.eventsThisMonth.push(this.options.events[e])}}else{this.eventsThisMonth=[];for(var e=0,f=this.options.events.length;f>e;e++)this.options.events[e]._clndrDateObject.format("YYYY-MM")==b.format("YYYY-MM")&&this.eventsThisMonth.push(this.options.events[e]);if(this.options.showAdjacentMonths){var g=b.clone().subtract("months",1),h=b.clone().add("months",1);this.eventsLastMonth=[];for(var e=0,f=this.options.events.length;f>e;e++)this.options.events[e]._clndrDateObject.format("YYYY-MM")==g.format("YYYY-MM")&&this.eventsLastMonth.push(this.options.events[e]);this.eventsNextMonth=[];for(var e=0,f=this.options.events.length;f>e;e++)this.options.events[e]._clndrDateObject.format("YYYY-MM")==h.format("YYYY-MM")&&this.eventsNextMonth.push(this.options.events[e])}}var i=c.weekday()-this.options.weekOffset;if(0>i&&(i+=7),this.options.showAdjacentMonths)for(var e=0;i>e;e++){var j=a([b.year(),b.month(),e-i+1]);daysArray.push(this.createDayObject(j,this.eventsLastMonth))}else for(var e=0;i>e;e++)daysArray.push(this.calendarDay({classes:this.options.targets.empty+" last-month"}));for(var k=c.daysInMonth(),e=1;k>=e;e++){var j=a([b.year(),b.month(),e]);daysArray.push(this.createDayObject(j,this.eventsThisMonth))}for(var e=1;daysArray.length%7!==0;){if(this.options.showAdjacentMonths){var j=a([b.year(),b.month(),k+e]);daysArray.push(this.createDayObject(j,this.eventsNextMonth))}else daysArray.push(this.calendarDay({classes:this.options.targets.empty+" next-month"}));e++}if(this.options.forceSixRows&&42!==daysArray.length)for(var l=a(daysArray[daysArray.length-1].date).add("days",1);daysArray.length<42;)this.options.showAdjacentMonths?(daysArray.push(this.createDayObject(a(l),this.eventsNextMonth)),l.add("days",1)):daysArray.push(this.calendarDay({classes:this.options.targets.empty+" next-month"}));return daysArray},j.prototype.createDayObject=function(c,d){var e=[],f=a(),g=this,h=0,i=d.length;for(h;i>h;h++)if(g.options.multiDayEvents){var j=d[h]._clndrStartDateObject,k=d[h]._clndrEndDateObject;(c.isSame(j,"day")||c.isAfter(j,"day"))&&(c.isSame(k,"day")||c.isBefore(k,"day"))&&e.push(d[h])}else d[h]._clndrDateObject.date()==c.date()&&e.push(d[h]);var l="";return f.format("YYYY-MM-DD")==c.format("YYYY-MM-DD")&&(l+=" today"),c.isBefore(f,"day")&&(l+=" past"),e.length&&(l+=" event"),this.month.month()>c.month()?(l+=" adjacent-month",l+=this.month.year()===c.year()?" last-month":" next-month"):this.month.month()<c.month()&&(l+=" adjacent-month",l+=this.month.year()===c.year()?" next-month":" last-month"),this.options.constraints&&(this.options.constraints.startDate&&c.isBefore(a(this.options.constraints.startDate))&&(l+=" inactive"),this.options.constraints.endDate&&c.isAfter(a(this.options.constraints.endDate))&&(l+=" inactive")),!c.isValid()&&c.hasOwnProperty("_d")&&c._d!=b&&(c=a(c._d)),l+=" calendar-day-"+c.format("YYYY-MM-DD"),l+=" calendar-dow-"+c.weekday(),this.calendarDay({day:c.date(),classes:this.options.targets.day+l,events:e,date:c})},j.prototype.render=function(){this.calendarContainer.innerHTML="";var b=this.createDaysObject(this.month),d=(this.month,{daysOfTheWeek:this.daysOfTheWeek,numberOfRows:Math.ceil(b.length/7),days:b,month:this.month.format("MMMM"),year:this.month.year(),eventsThisMonth:this.eventsThisMonth,eventsLastMonth:this.eventsLastMonth,eventsNextMonth:this.eventsNextMonth,extras:this.options.extras});if(this.calendarContainer.innerHTML=this.options.render?this.options.render.apply(this,[d]):this.compiledClndrTemplate(d),this.options.constraints){for(target in this.options.targets)if(target!=this.options.targets.day)for(var e=c(this.options.targets[target],this.element),f=0,g=e.length;g>f;f++)e[f].className=-1!==e[f].className.indexOf("inactive")?e[f].className+" inactive":e[f].className.replace("inactive","");var h=null,i=null;if(this.options.constraints.startDate&&(h=a(this.options.constraints.startDate)),this.options.constraints.endDate&&(i=a(this.options.constraints.endDate)),h&&this.month.isSame(h,"month"))for(var e=c(this.options.targets.previousButton,this.element),f=0,g=e.length;g>f;f++)e[f].className=-1!==e[f].className.indexOf("inactive")?e[f].className+" inactive":e[f].className.replace("inactive","");if(i&&this.month.isSame(i,"month"))for(var e=c(this.options.targets.nextButton,this.element),f=0,g=e.length;g>f;f++)e[f].className=-1!==e[f].className.indexOf("inactive")?e[f].className+" inactive":e[f].className.replace("inactive","");if(h&&a(h).subtract("years",1).isBefore(a(this.month).subtract("years",1)))for(var e=c(this.options.targets.previousYearButton,this.element),f=0,g=e.length;g>f;f++)e[f].className=-1!==e[f].className.indexOf("inactive")?e[f].className+" inactive":e[f].className.replace("inactive","");if(i&&a(i).add("years",1).isAfter(a(this.month).add("years",1)))for(var e=c(this.options.targets.nextYearButton,this.element),f=0,g=e.length;g>f;f++)e[f].className=-1!==e[f].className.indexOf("inactive")?e[f].className+" inactive":e[f].className.replace("inactive","");if(h&&h.isAfter(a(),"month")||i&&i.isBefore(a(),"month"))for(var e=c(this.options.targets.today,this.element),f=0,g=e.length;g>f;f++)e[f].className=-1!==e[f].className.indexOf("inactive")?e[f].className+" inactive":e[f].className.replace("inactive","")}this.bindEvents(),this.options.doneRendering&&this.options.doneRendering.apply(this,[])},j.prototype.bindEvents=function(){for(var a=this,b=c(a.options.targets.day,a.element),d=0,e=b.length;e>d;d++)!function(c){f(b[c],"click",function(){if(a.options.clickEvents.click){var d=a.buildTargetObject(b[c],!0);a.options.clickEvents.click.apply(a,[d])}a.options.adjacentDaysChangeMonth&&(-1!==b[c].className.indexOf(".last-month")?a.backActionWithContext(a):-1!==b[c].className.indexOf("next-month")&&a.forwardActionWithContext(a))})}(d);for(var b=c(a.options.targets.empty,a.element),d=0,e=b.length;e>d;d++)!function(c){f(b[c],"click",function(){if(a.options.clickEvents.click){var d=a.buildTargetObject(b[c],!1);a.options.clickEvents.click.apply(a,[d])}a.options.adjacentDaysChangeMonth&&(-1!==b[c].className.indexOf(".last-month")?a.backActionWithContext(a):-1!==b[c].className.indexOf("next-month")&&a.forwardActionWithContext(a))})}(d);var g=c(a.options.targets.previousButton,a.element)[0];f(g,"click",function(){a.backAction.call(a)});var g=c(a.options.targets.nextButton,a.element)[0];f(g,"click",function(){a.forwardAction.call(a)});var g=c(a.options.targets.todayButton,a.element)[0];f(g,"click",function(){a.todayAction.call(a)});var g=c(a.options.targets.nextYearButton,a.element)[0];f(g,"click",function(){a.nextYearAction.call(a)});var g=c(a.options.targets.previousYearButton,a.element)[0];f(g,"click",function(){a.previousYearAction.call(a)})},j.prototype.buildTargetObject=function(b,c){var d={element:b,events:[],date:null};if(c){var e,f=b.className.indexOf("calendar-day-");if(0!==f?(e=b.className.substring(f+13,f+23),d.date=a(e)):d.date=null,this.options.events)if(this.options.multiDayEvents){d.events=[];for(var g=0,h=this.options.events.length;h>g;g++)(d.date.isSame(this.options.events[g]._clndrStartDateObject,"day")||d.date.isAfter(this.options.events[g]._clndrStartDateObject,"day"))&&(d.date.isSame(this.options.events[g]._clndrEndDateObject,"day")||d.date.isBefore(this.options.events[g]._clndrEndDateObject,"day"))&&d.events.push(this.options.events[g])}else{d.events=[];for(var g=0,h=this.options.events.length;h>g;g++)this.options.events[g]._clndrDateObject.format("YYYY-MM-DD")==e&&d.events.push(this.options.events[g])}}return d},j.prototype.forwardAction=function(){var a=this;a.forwardActionWithContext(a)},j.prototype.backAction=function(){var a=this;a.backActionWithContext(a)},j.prototype.backActionWithContext=function(b){if(-1===c(b.options.targets.previousButton,b.element)[0].className.indexOf("inactive")){var d=!b.month.isSame(a(b.month).subtract("months",1),"year");b.month.subtract("months",1),b.render(),b.options.clickEvents.previousMonth&&b.options.clickEvents.previousMonth.apply(b,[a(b.month)]),b.options.clickEvents.onMonthChange&&b.options.clickEvents.onMonthChange.apply(b,[a(b.month)]),d&&b.options.clickEvents.onYearChange&&b.options.clickEvents.onYearChange.apply(b,[a(b.month)])}},j.prototype.forwardActionWithContext=function(b){if(-1===c(b.options.targets.nextButton,b.element)[0].className.indexOf("inactive")){var d=!b.month.isSame(a(b.month).add("months",1),"year");b.month.add("months",1),b.render(),b.options.clickEvents.nextMonth&&b.options.clickEvents.nextMonth.apply(b,[a(b.month)]),b.options.clickEvents.onMonthChange&&b.options.clickEvents.onMonthChange.apply(b,[a(b.month)]),d&&b.options.clickEvents.onYearChange&&b.options.clickEvents.onYearChange.apply(b,[a(b.month)])}},j.prototype.todayAction=function(){var b=this,c=!b.month.isSame(a(),"month"),d=!b.month.isSame(a(),"year");b.month=a().startOf("month"),b.options.clickEvents.today&&b.options.clickEvents.today.apply(b,[a(b.month)]),c&&(b.render(),b.month=a(),b.options.clickEvents.onMonthChange&&b.options.clickEvents.onMonthChange.apply(b,[a(b.month)]),d&&b.options.clickEvents.onYearChange&&b.options.clickEvents.onYearChange.apply(b,[a(b.month)]))},j.prototype.nextYearAction=function(){var b=this;-1===c(b.options.targets.nextYearButton,b.element)[0].className.indexOf("inactive")&&(b.month.add("years",1),b.render(),b.options.clickEvents.nextYear&&b.options.clickEvents.nextYear.apply(b,[a(b.month)]),b.options.clickEvents.onMonthChange&&b.options.clickEvents.onMonthChange.apply(b,[a(b.month)]),b.options.clickEvents.onYearChange&&b.options.clickEvents.onYearChange.apply(b,[a(b.month)]))},j.prototype.previousYearAction=function(){var b=this;-1===c(b.options.targets.previousYear,b.element)[0].className.indexOf("inactive")&&(b.month.subtract("years",1),b.render(),b.options.clickEvents.previousYear&&b.options.clickEvents.previousYear.apply(b,[a(b.month)]),b.options.clickEvents.onMonthChange&&b.options.clickEvents.onMonthChange.apply(b,[a(b.month)]),b.options.clickEvents.onYearChange&&b.options.clickEvents.onYearChange.apply(b,[a(b.month)]))},j.prototype.forward=function(b){return this.month.add("months",1),this.render(),b&&b.withCallbacks&&(this.options.clickEvents.onMonthChange&&this.options.clickEvents.onMonthChange.apply(this,[a(this.month)]),0===this.month.month()&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[a(this.month)])),this},j.prototype.back=function(b){return this.month.subtract("months",1),this.render(),b&&b.withCallbacks&&(this.options.clickEvents.onMonthChange&&this.options.clickEvents.onMonthChange.apply(this,[a(this.month)]),11===this.month.month()&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[a(this.month)])),this},j.prototype.next=function(a){return this.forward(a),this},j.prototype.previous=function(a){return this.back(a),this},j.prototype.setMonth=function(b,c){return this.month.month(b),this.render(),c&&c.withCallbacks&&this.options.clickEvents.onMonthChange&&this.options.clickEvents.onMonthChange.apply(this,[a(this.month)]),this},j.prototype.nextYear=function(b){return this.month.add("year",1),this.render(),b&&b.withCallbacks&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[a(this.month)]),this},j.prototype.previousYear=function(b){return this.month.subtract("year",1),this.render(),b&&b.withCallbacks&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[a(this.month)]),this},j.prototype.setYear=function(b,c){return this.month.year(b),this.render(),c&&c.withCallbacks&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[a(this.month)]),this},j.prototype.setEvents=function(a){return this.options.events=this.options.multiDayEvents?this.addMultiDayMomentObjectsToEvents(a):this.addMomentObjectToEvents(a),this.render(),this},j.prototype.addEvents=function(a){return this.options.events=this.options.multiDayEvents?e({},this.options.events,this.addMultiDayMomentObjectsToEvents(a)):e({},this.options.events,this.addMomentObjectToEvents(a)),this.render(),this},j.prototype.addMomentObjectToEvents=function(b){var c=this,d=0,e=b.length;for(d;e>d;d++)b[d]._clndrDateObject=a(b[d][c.options.dateParameter]);return b},j.prototype.addMultiDayMomentObjectsToEvents=function(b){var c=this,d=0,e=b.length;for(d;e>d;d++)b[d]._clndrStartDateObject=a(b[d][c.options.multiDayEvents.startDate]),b[d]._clndrEndDateObject=a(b[d][c.options.multiDayEvents.endDate]);return b},j.prototype.calendarDay=function(a){var b={day:"",classes:this.options.targets.empty,events:[],date:null};return e({},b,a)},j});